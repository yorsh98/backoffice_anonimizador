{% extends "base.html" %}

{% block title %}Documentos{% endblock %}

{% block content %}
  <h1>Documentos</h1>
  <form method="get">
    <div>
      <label for="id_name">Nombre</label>
      <input id="id_name" type="text" name="name" value="{{ filters.name }}">
    </div>
    <div>
      <label for="id_status">Estado</label>
      <select id="id_status" name="status">
        <option value="">Todos</option>
        <option value="uploaded" {% if filters.status == 'uploaded' %}selected{% endif %}>uploaded</option>
        <option value="processing" {% if filters.status == 'processing' %}selected{% endif %}>processing</option>
        <option value="ready" {% if filters.status == 'ready' %}selected{% endif %}>ready</option>
        <option value="error" {% if filters.status == 'error' %}selected{% endif %}>error</option>
      </select>
    </div>
    <div>
      <label for="id_date_from">Desde</label>
      <input id="id_date_from" type="date" name="date_from" value="{{ filters.date_from }}">
    </div>
    <div>
      <label for="id_date_to">Hasta</label>
      <input id="id_date_to" type="date" name="date_to" value="{{ filters.date_to }}">
    </div>
    {% if is_admin %}
      <div>
        <label for="id_user">Usuario</label>
        <select id="id_user" name="user">
          <option value="">Todos</option>
          {% for user in users %}
            <option value="{{ user.id }}" {% if filters.user == user.id|stringformat:'s' %}selected{% endif %}>{{ user.username }}</option>
          {% endfor %}
        </select>
      </div>
    {% endif %}
    <button type="submit">Filtrar</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>Nombre</th>
        <th>Estado</th>
        <th>Subido por</th>
        <th>Fecha</th>
      </tr>
    </thead>
    <tbody>
      {% for document in documents %}
        <tr>
          <td><a href="{% url 'documents:detail' document.id %}">{{ document.original_filename }}</a></td>
          <td>{{ document.status }}</td>
          <td>{{ document.uploaded_by.username }}</td>
          <td>{{ document.uploaded_at|date:"Y-m-d H:i" }}</td>
        </tr>
      {% empty %}
        <tr>
          <td colspan="4">No hay documentos.</td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}
